<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.0.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="webpack核心概念Entry入口(Entry)指示webpack以哪个文件为入口起点开始打包，分析构建内部依赖图。 Output输出(Entry)指示webpack打包后的资源输出到哪里去，以及如何命名。 LoaderLoader让webpack能够去处理那些非JavaScript的文件。 Plugins插件(Plugins)可以用于执行范围内更广的任务，如打包优化和压缩，重新定义环境中变量等">
<meta name="keywords" content="Webpack">
<meta property="og:type" content="article">
<meta property="og:title" content="webpack4概念及常用配置">
<meta property="og:url" content="https://akitaSummer.github.io/2020/06/07/webpack4概念及常用配置/index.html">
<meta property="og:site_name" content="Akita Summer&#39;s Blog">
<meta property="og:description" content="webpack核心概念Entry入口(Entry)指示webpack以哪个文件为入口起点开始打包，分析构建内部依赖图。 Output输出(Entry)指示webpack打包后的资源输出到哪里去，以及如何命名。 LoaderLoader让webpack能够去处理那些非JavaScript的文件。 Plugins插件(Plugins)可以用于执行范围内更广的任务，如打包优化和压缩，重新定义环境中变量等">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2023-02-12T17:56:09.456Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="webpack4概念及常用配置">
<meta name="twitter:description" content="webpack核心概念Entry入口(Entry)指示webpack以哪个文件为入口起点开始打包，分析构建内部依赖图。 Output输出(Entry)指示webpack打包后的资源输出到哪里去，以及如何命名。 LoaderLoader让webpack能够去处理那些非JavaScript的文件。 Plugins插件(Plugins)可以用于执行范围内更广的任务，如打包优化和压缩，重新定义环境中变量等">






  <link rel="canonical" href="https://akitaSummer.github.io/2020/06/07/webpack4概念及常用配置/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>webpack4概念及常用配置 | Akita Summer's Blog</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>


</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"><a href="https://github.com/akitaSummer" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Akita Summer's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://akitaSummer.github.io/2020/06/07/webpack4概念及常用配置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Akita Summer">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/v2-e386393694cb08152bb316fa79bba113_hd.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Akita Summer's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">webpack4概念及常用配置

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2020-06-07 19:56:25" itemprop="dateCreated datePublished" datetime="2020-06-07T19:56:25+08:00">2020-06-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2023-02-13 01:56:09" itemprop="dateModified" datetime="2023-02-13T01:56:09+08:00">2023-02-13</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <a href="/2020/06/07/webpack4概念及常用配置/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count gitment-comments-count" data-xid="/2020/06/07/webpack4概念及常用配置/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="webpack核心概念"><a href="#webpack核心概念" class="headerlink" title="webpack核心概念"></a>webpack核心概念</h1><h2 id="Entry"><a href="#Entry" class="headerlink" title="Entry"></a>Entry</h2><p>入口(Entry)指示webpack以哪个文件为入口起点开始打包，分析构建内部依赖图。</p>
<h2 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h2><p>输出(Entry)指示webpack打包后的资源输出到哪里去，以及如何命名。</p>
<h2 id="Loader"><a href="#Loader" class="headerlink" title="Loader"></a>Loader</h2><p>Loader让webpack能够去处理那些非JavaScript的文件。</p>
<h2 id="Plugins"><a href="#Plugins" class="headerlink" title="Plugins"></a>Plugins</h2><p>插件(Plugins)可以用于执行范围内更广的任务，如打包优化和压缩，重新定义环境中变量等。</p>
<h1 id="webpack基本配置"><a href="#webpack基本配置" class="headerlink" title="webpack基本配置"></a>webpack基本配置</h1><h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><p>首先我们先安装webpack<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack webpack-cli --save-dev</span><br></pre></td></tr></table></figure></p>
<p>or<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add webpack webpack-cli --dev</span><br></pre></td></tr></table></figure></p>
<p>在我们日常开发的时候，会有开发环境和生产环境，不同的环境下，打包的配置也必然有相同点和不同点。<br>所以我们在创建配置文件时，使用<code>webpack.common.js</code>、<code>webpack.dev.js</code>和<code>webpack.prod.js</code>分别存放公用配置、开发环境打包配置和生产环境打包配置。</p>
<p><code>webpack.common.js</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基础打包配置</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        bundle: path.resolve(__dirname, <span class="string">'../src/index.js'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'../dist'</span>),</span><br><span class="line">        filename: <span class="string">'[name].[hash].js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: []</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>webpack.dev.js</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开发环境配置</span></span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> baseConfig = <span class="built_in">require</span>(<span class="string">'./webpack.base.conf'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(baseConfig, &#123;</span><br><span class="line">    mode: <span class="string">'development'</span>, <span class="comment">// 设置为开发环境</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p><code>webpack.prod.js</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生产环境配置</span></span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> baseConfig = <span class="built_in">require</span>(<span class="string">'./webpack.base.conf'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(baseConfig, &#123;</span><br><span class="line">    mode: <span class="string">'production'</span>, <span class="comment">// 生产环境</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>并在<code>package.json</code>中配置好<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;start&quot;: &quot;webpack --config webpack.dev.js&quot;,</span><br><span class="line">    &quot;build&quot;: &quot;webpack --env.production --config webpack.pord.js&quot;,</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure></p>
<p>这样我们就可以分别使用<code>yarn start</code>和<code>yarn build</code>运行开发和生产环境打包了</p>
<h2 id="entry"><a href="#entry" class="headerlink" title="entry"></a>entry</h2><p>entry可以以单个文件作为入口<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">entry: <span class="string">'./src/js/entry.js'</span></span><br></pre></td></tr></table></figure></p>
<p>也可以以多个文件为入口<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">entry: &#123;</span><br><span class="line">      lodash: <span class="string">'./src/js/lodash.js'</span>,</span><br><span class="line">      main: <span class="string">'./src/js/entry.js'</span>,</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="output"><a href="#output" class="headerlink" title="output"></a>output</h2><p>output常用配置如下<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">output: &#123;</span><br><span class="line">       path: path.resolve(__dirname, <span class="string">'dist/js'</span>), <span class="comment">// 输出文件目录</span></span><br><span class="line">       publicPath: <span class="string">"/"</span>, <span class="comment">// script中src的前缀，可用于cdn，将前缀改为http://cdn.com.cn等</span></span><br><span class="line">       filename: <span class="string">'[name]_[hash].[ext]'</span>, <span class="comment">// 输出文件名称</span></span><br><span class="line">       filename: <span class="string">'bundle.js'</span>, <span class="comment">// 使用contenthash，只有当源代码改变时，才会改变输出名，但在热更新情况下不能使用，可以做到重新打包代码上线的时候，用户只需要更新有变化的代码，而没有变化的代码，用户可以直接使用本地的缓存</span></span><br><span class="line">       chunkFilename: <span class="string">"[name].chunk.js"</span>, <span class="comment">// 非入口chunk名称，</span></span><br><span class="line">       libraryTarget: <span class="string">'umd'</span>, <span class="comment">// 在制作库时需要，保证任何引用方式都能正确引用</span></span><br><span class="line">       library: <span class="string">'library'</span>, <span class="comment">// 可以通过src标签引入，并且使用library作为全局变量，如果libraryTarget为this，则library会挂载到全局this</span></span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure></p>
<h2 id="module"><a href="#module" class="headerlink" title="module"></a>module</h2><p>module是loader放置的位置，我们前端一般会需要解析css文件，图片文件，和字体文件<br>module常用配置如下<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">       rules: [&#123;</span><br><span class="line">               test: <span class="regexp">/\.(png|jpg|gif)$/</span>,</span><br><span class="line">               use: [&#123;</span><br><span class="line">                   loader: <span class="string">'url-loader'</span>,</span><br><span class="line">                   options: &#123;</span><br><span class="line">                       limit: <span class="number">8192</span>,</span><br><span class="line">                       <span class="comment">// placeholder：占位符</span></span><br><span class="line">                       name: <span class="string">'[name].[ext]'</span>, <span class="comment">// 打包文件后，文件名为原文件名</span></span><br><span class="line">                       outputPath: <span class="string">'images/'</span></span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;]</span><br><span class="line">           &#125;,</span><br><span class="line">           &#123;</span><br><span class="line">               test: <span class="regexp">/\.(eot|ttf|svg|woff|woff2)$/</span>,</span><br><span class="line">               use: &#123;</span><br><span class="line">                   loader: <span class="string">'file-loader'</span>, <span class="comment">// 打包字体文件</span></span><br><span class="line">                   force: <span class="string">'pre'</span>, <span class="comment">// 强制loader优于其他loader</span></span><br><span class="line">               &#125;</span><br><span class="line">           &#125;,</span><br><span class="line">           &#123;</span><br><span class="line">           test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">           use: [</span><br><span class="line">               <span class="string">'style-loader'</span>,</span><br><span class="line">               <span class="string">'css-loader'</span></span><br><span class="line">           ]</span><br><span class="line">       &#125;</span><br><span class="line">       ]</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>其中所有的loader都需要使用<code>yarn add --dev</code>安装，<br>当use存在多个loader时，执行顺序是从下到上。</p>
<h2 id="plugins"><a href="#plugins" class="headerlink" title="plugins"></a>plugins</h2><p>plugins可以在webpack运行到某个时刻的时候，帮你做一些事情,在我们通常情况下，会用到html-webpack-plugin和clean-webpack-plugin这两个plugin，他们分别用于自动生成html和每次打包时清除之前打包的文件<br>首先先安装两个plugin<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add html-webpack-plugin clean-webpack-plugin --dev</span><br></pre></td></tr></table></figure></p>
<p>然后我们在根目录下创建一个<code>index.html文件</code>作为html-webpack-plugin的html模板<br>在<code>webpack.common.js</code>中配置<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>); <span class="comment">//自动生成html文件的插件</span></span><br><span class="line"><span class="keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>); <span class="comment">//清除之前打包的文件</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">plugins: [ <span class="comment">// plugins可以在webpack运行到某个时刻的时候，帮你做一些事情</span></span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123; <span class="attr">template</span>: <span class="string">'./index.html'</span> &#125;),</span><br><span class="line">        <span class="keyword">new</span> CleanWebpackPlugin(&#123;</span><br><span class="line">            root: path.resolve(__dirname, <span class="string">'./'</span>), <span class="comment">// 设置CleanWebpackPlugin的根目录</span></span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure></p>
<h2 id="externals"><a href="#externals" class="headerlink" title="externals"></a>externals</h2><p>externals是用于配置source-map的，source-map默认开启，是打包文件对原文件的映射，通过source-map，我们就可以知道源文件哪行出错<br>在<code>webpack.dev.js</code>中配置<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">devtool: <span class="string">'cheap-module-eval-source-map'</span></span><br></pre></td></tr></table></figure></p>
<p>inline- 开头：将.map文件存至js文件最后一行<br>cheap- 开头：简化提示，只告诉哪行出错<br>module- 开头： 包含module的提示<br>eval-是通过eval储存映射内容<br>在<code>weback.prod.js</code>中配置<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">devtool: <span class="string">'cheap-module-source-map'</span></span><br></pre></td></tr></table></figure></p>
<p>不同的环境下，我们需要的source-map也不同，这里需要注意</p>
<h2 id="resolve"><a href="#resolve" class="headerlink" title="resolve"></a>resolve</h2><p>resolve是解析模块的规则，我们在这里可以进行配置解析的路径等功能<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">resolve: &#123;</span><br><span class="line">        extensions: [<span class="string">'.js'</span>, <span class="string">'.jsx'</span>], <span class="comment">// 省略后缀，从左到右查找</span></span><br><span class="line">        mainFile: [<span class="string">'index'</span>, <span class="string">'child'</span>], <span class="comment">// 未写文件名，则优先加载的文件名</span></span><br><span class="line">        alias: &#123;</span><br><span class="line">            path: path.resolve(__dirname, <span class="string">'./src/'</span>) <span class="comment">// 路径别名</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="常见需求配置"><a href="#常见需求配置" class="headerlink" title="常见需求配置"></a>常见需求配置</h1><h2 id="本地启动开发服务器进行开发"><a href="#本地启动开发服务器进行开发" class="headerlink" title="本地启动开发服务器进行开发"></a>本地启动开发服务器进行开发</h2><p>像react和vue使用yarn start时，启动一个本地服务器，我们通常需要安装<code>webpack-dev-server</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add webpack-dev-server --dev</span><br></pre></td></tr></table></figure></p>
<p>然后修改我们的<code>package.json</code>文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    ...</span><br><span class="line">    &quot;start&quot;: &quot;webpack-dev-server --config webpack.dev.js&quot;,</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>并在<code>webpack.dev.js</code>中配置devServer<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">        contentBase: path.resolve(__dirname, <span class="string">'../dist'</span>),</span><br><span class="line">        open: <span class="literal">true</span>, <span class="comment">// 打开浏览器</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>也需要在plugins下添加<code>webpack.HotModuleReplacementPlugin</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plugins: [</span><br><span class="line">        <span class="keyword">new</span> webpack.HotModuleReplacementPlugin(), <span class="comment">// 热加载插件</span></span><br><span class="line">    ]</span><br></pre></td></tr></table></figure></p>
<p>但这样是不能完成的，我们还需要在js文件中添加如下代码<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">  <span class="built_in">module</span>.hot.accept(<span class="string">'./content'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="comment">// ./content.js 文件改变后，进行一些事情，例如更新 HMR热更新引入后才有用</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在react和vue中，因为他们的loader内部集成了这样的代码，所以无需写入上面的代码，也能实现热更新<br>当然，你可以配置更多选项，让你的本地服务器更加完善，常用配置如下<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">        contentBase: <span class="string">'./dist'</span>, <span class="comment">// 打包文件位置</span></span><br><span class="line">        open: <span class="literal">true</span>, <span class="comment">// 自动打开浏览器</span></span><br><span class="line">        <span class="comment">// historyApiFallback: true, // 解决单页面路由browser后端问题</span></span><br><span class="line">        historyApiFallback: &#123;</span><br><span class="line">            rewrites: [&#123;</span><br><span class="line">                <span class="keyword">from</span>: <span class="regexp">/abc.html/</span>,</span><br><span class="line">                to: <span class="string">'/views/landing.html'</span> <span class="comment">// 也可传入function（content） &#123;&#125; 结合逻辑动态返回路径</span></span><br><span class="line">            &#125;]</span><br><span class="line">        &#125;,</span><br><span class="line">        proxy: &#123;</span><br><span class="line">            <span class="comment">// '/api': 'http://localhost:3000', // 配置跨域代理</span></span><br><span class="line">            <span class="string">'/api'</span>: &#123;</span><br><span class="line">                target: <span class="string">'http://loaclhost:3000'</span>,</span><br><span class="line">                secure: <span class="literal">false</span>, <span class="comment">// 对https网址的请求转发</span></span><br><span class="line">                pathRewrite: &#123;</span><br><span class="line">                    <span class="string">'header.json'</span>: <span class="string">'demo.json'</span> <span class="comment">// 请求header.json文件会返回demo.json文件</span></span><br><span class="line">                &#125;,</span><br><span class="line">                bypass: <span class="function"><span class="keyword">function</span> (<span class="params">req, res, proxyOptions</span>) </span>&#123; <span class="comment">// 根据特定请求，返回特定内容</span></span><br><span class="line">                    <span class="keyword">if</span> (req.header.accept.indexOf(<span class="string">'html'</span>)) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">'/index.html'</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                changeOrigin: <span class="literal">true</span>, <span class="comment">// 突破Origin限制</span></span><br><span class="line">                overlay: <span class="literal">true</span>, <span class="comment">// eslint检测出错时，会弹出页面提醒</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// port: 8888, // 配置端口</span></span><br><span class="line">        hot: <span class="literal">true</span>, <span class="comment">// 热模块加载</span></span><br><span class="line">        hotOnly: <span class="literal">true</span>， <span class="comment">// 即使hot未生效，也不刷新页面</span></span><br><span class="line">        clientLogLevel: <span class="string">'none'</span>, <span class="comment">// 不需要显示启动服务器日志信息</span></span><br><span class="line">        quiet: <span class="literal">true</span>, <span class="comment">// 除了一些基本的配置以外，其他的内容都不要显示</span></span><br><span class="line">        overlay: <span class="literal">false</span>, <span class="comment">// 如果出错了，不需要全局显示</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>配置完毕后，在控制台输入<code>yarn start</code>就可以启动了</p>
<h2 id="解析ES6语法"><a href="#解析ES6语法" class="headerlink" title="解析ES6语法"></a>解析ES6语法</h2><p>为了解析ES6及以上语法，需要安装<code>babel-loader</code>和<code>@babel/perset-env</code><br>然后在<code>webpack.common.js</code>中添加配置<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            ......</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span>, <span class="comment">// 第三方库除外</span></span><br><span class="line">                use: [&#123;</span><br><span class="line">                        loader: <span class="string">'babel-loader'</span>, <span class="comment">// 配置babel-loader</span></span><br><span class="line">                        query: &#123;</span><br><span class="line">                            presets: [</span><br><span class="line">                                [<span class="string">"@babel/preset-env"</span>, &#123; <span class="comment">// es6语法转换es5语法</span></span><br><span class="line">                                    useBuiltIns: <span class="string">"usage"</span>, <span class="comment">// 根据业务代码，添加@babel/polyfill兼容的内容</span></span><br><span class="line">                                    targets: &#123;</span><br><span class="line">                                        chrome: <span class="string">"67"</span>, <span class="comment">// 运行的环境</span></span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;],</span><br><span class="line">                            ]</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">            &#125;,</span><br><span class="line">            ......</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>babel只负责语法转换，比如将ES6的语法转换成ES5。但如果有些对象、方法，浏览器本身不支持，比如：</p>
<ul>
<li>全局对象：Promise、WeakMap 等。</li>
<li>全局静态函数：Array.from、Object.assign 等。</li>
<li>实例方法：比如 Array.prototype.includes 等。<br>此时，需要引入babel-polyfill来模拟实现这些对象、方法。<br>所以，在query里面配置了useBuiltIns，需要安装<code>@babel/polyfill</code>。<br>并且要在你的入口文件中引入<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'@babel/polyfill'</span> <span class="comment">// 引入babel/polyfill，用于兼容低版本浏览器</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>但是<code>@babel/polyfill</code>会污染全局环境，制作库时，需要使用<code>@babel/plugin-transform-runtime</code><br><code>@babel/plugin-transform-runtime</code>的配置较为简单，只需要在query中配置plugins<br>当然，你也可以在其中配置<code>dynamic-import-webpack</code>支持动态import<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            ......</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span>, <span class="comment">// 第三方库除外</span></span><br><span class="line">                use: [&#123;</span><br><span class="line">                        loader: <span class="string">'babel-loader'</span>, <span class="comment">// 配置babel-loader</span></span><br><span class="line">                        query: &#123;</span><br><span class="line">                            presets: [</span><br><span class="line">                                [<span class="string">"@babel/preset-env"</span>, &#123; <span class="comment">// es6语法转换es5语法</span></span><br><span class="line">                                    useBuiltIns: <span class="string">"usage"</span>, <span class="comment">// 根据业务代码，添加@babel/polyfill兼容的内容</span></span><br><span class="line">                                    targets: &#123;</span><br><span class="line">                                        chrome: <span class="string">"67"</span>, <span class="comment">// 运行的环境</span></span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;],</span><br><span class="line">                            ],</span><br><span class="line">                            plugins: [</span><br><span class="line">                                [<span class="string">"@babel/plugin-transform-runtime"</span>, &#123; <span class="comment">// @babel/polyfill会污染全局环境，制作库时，需要使用@babel/plugin-transform-runtime</span></span><br><span class="line">                                    <span class="string">"corejs"</span>: <span class="number">2</span>,</span><br><span class="line">                                    <span class="string">"helpers"</span>: <span class="literal">true</span>,</span><br><span class="line">                                    <span class="string">"regenerator"</span>: <span class="literal">true</span>,</span><br><span class="line">                                    <span class="string">"useESModules"</span>: <span class="literal">false</span>,</span><br><span class="line">                                &#125;],</span><br><span class="line">                                <span class="string">"dynamic-import-webpack"</span>, <span class="comment">// 动态import</span></span><br><span class="line">                            ]</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">            &#125;,</span><br><span class="line">            ......</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>babel的配置有很多，详情可去官网查询，但是如果配置过多，我们可以将其单独抽取出来，在根目录下新建一个.babelrc文件，用于储存babel的配置<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"plugins"</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"@babel/plugin-transform-runtime"</span>, &#123;</span><br><span class="line">      <span class="attr">"corejs"</span>: <span class="number">2</span>,</span><br><span class="line">      <span class="attr">"helpers"</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">"regenerator"</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">"useESModules"</span>: <span class="literal">false</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">"@babel/plugin-transform-react-constant-elements"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Tree-Shaking"><a href="#Tree-Shaking" class="headerlink" title="Tree Shaking"></a>Tree Shaking</h2><p>Tree Shaking 是一个术语，通常用于描述移除javascript上下文中的未引用代码。<br>Tree Shaking 在production模式下是默认开启的，但是在development模式下，就需要我们主动开启。<br>在<code>webpack.dev.js</code>中添加<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">optimization: &#123;</span><br><span class="line">        usedExports: <span class="literal">true</span>, <span class="comment">// development 开发环境下，设置Tree shaking</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>需要注意的是Tree shaking, 只支持ES Module，即静态引用，js文件中不要使用commonjs引入方法。<br>并且当你引入css文件时，会写如下代码<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'../css/test.css'</span></span><br></pre></td></tr></table></figure></p>
<p>这样的代码Tree Shaking会默认将其移除，所以我们需要在<code>package.json</code>中添加配置<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">"sideEffects": [</span><br><span class="line">    <span class="string">"*.css"</span></span><br><span class="line">  ]</span><br></pre></td></tr></table></figure></p>
<p>这样就可以防止css文件被Tree Shaking默认移除了。</p>
<h2 id="代码分割-Code-Splitting"><a href="#代码分割-Code-Splitting" class="headerlink" title="代码分割(Code Splitting)"></a>代码分割(Code Splitting)</h2><p>代码分割可以将代码分割到不同的打包文件，代码分割可以控制资源加载优先级，如果使用合理，会极大影响加载时间。<br>如果想要开启代码分割，则可以在<code>webpack.common.js</code>中配置<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">optimization: &#123;</span><br><span class="line">        splitChunks: &#123;</span><br><span class="line">            chunks: <span class="string">"all"</span>, <span class="comment">// 代码分割</span></span><br><span class="line">            minSize: <span class="number">30000</span>, <span class="comment">// 对代码分割的最小文件大小</span></span><br><span class="line">            maxSize: <span class="number">0</span>, <span class="comment">// 代码分割文件最大大小</span></span><br><span class="line">            minChunks: <span class="number">1</span>, <span class="comment">// 代码分割文件至少被chunk或作为chunk引入的次数</span></span><br><span class="line">            maxAsyncRequests: <span class="number">5</span>, <span class="comment">// 总共最多分割成多少代码分割文件</span></span><br><span class="line">            maxInitialRequests: <span class="number">3</span>, <span class="comment">// 入口文件进行分割时最多分割成多少文件</span></span><br><span class="line">            automaticNameDelimiter: <span class="string">"~"</span>, <span class="comment">// 默认情况下，webpack将使用块的来源和名称生成名称, automaticNameDelimiter用于修改连接符</span></span><br><span class="line">            name: <span class="literal">true</span>, <span class="comment">// 拆分模块名称，true会根据模块和缓存键值对自动选择一个名称</span></span><br><span class="line">            cacheGroups: &#123; <span class="comment">// 决定拆分分割模块分割至哪个文件中，缓存分组</span></span><br><span class="line">                vendors: &#123;</span><br><span class="line">                    test: <span class="regexp">/[\\/]node_modules[\\/]/</span>, <span class="comment">// 模块保存的分割代码</span></span><br><span class="line">                    priority: <span class="number">-10</span>, <span class="comment">// 打包到此文件的优先级</span></span><br><span class="line">                    filename: <span class="string">'vendors.js'</span> <span class="comment">// 模块名字</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="comment">// default: false, // 默认分割文件放置地址</span></span><br><span class="line">                <span class="keyword">default</span>: &#123;</span><br><span class="line">                    priority: <span class="number">-20</span>,</span><br><span class="line">                    reuseExistingChunk: <span class="literal">true</span>, <span class="comment">// 是否复用之前打包过的模块</span></span><br><span class="line">                    filename: <span class="string">'common.js'</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>这只是同步代码的分割，当你进行了3.2中的<code>dynamic-import-webpack</code>配置后，你的动态引用都会自动进行代码分割。</p>
<h2 id="css的代码分割"><a href="#css的代码分割" class="headerlink" title="css的代码分割"></a>css的代码分割</h2><p>css文件也可以进行代码分割，我们需要安装<code>mini-css-extract-plugin</code>和<code>optimize-css-assets-webpack-plugin</code>这个两个插件，但是由于热加载目前不支持<code>mini-css-extract-plugin</code>，所以我们需要在<code>webpack.prod.js</code>中配置<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">'mini-css-extract-plugin'</span>) <span class="comment">// 将css从js中抽离出来，单独作为css文件引入，HMR目前不支持</span></span><br><span class="line"><span class="keyword">const</span> OptimizeCSSAssetsPlugin = <span class="built_in">require</span>(<span class="string">'optimize-css-assets-webpack-plugin'</span>) <span class="comment">// css文件压缩</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(baseConfig, &#123;</span><br><span class="line">  mode: <span class="string">'production'</span>, <span class="comment">// 生产环境</span></span><br><span class="line">  devtool: <span class="string">'cheap-module-source-map'</span>,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">      rules: [</span><br><span class="line">      &#123;</span><br><span class="line">          test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">          use: [</span><br><span class="line">          MiniCssExtractPlugin.loader, <span class="comment">// 将style-loader更换为MiniCssExtractPlugin.loader</span></span><br><span class="line">          <span class="string">'css-loader'</span></span><br><span class="line">          ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">          test: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">          use: [</span><br><span class="line">          MiniCssExtractPlugin.loader,</span><br><span class="line">          &#123;</span><br><span class="line">              loader: <span class="string">"css-loader"</span>, <span class="comment">// 若要配置loader，需要使用对象写法</span></span><br><span class="line">              options: &#123;</span><br><span class="line">              importLoaders: <span class="number">2</span>, <span class="comment">// 通过import引入的css文件需要再走下面两个loader</span></span><br><span class="line">              modules: <span class="literal">true</span>, <span class="comment">// 模块化css，通过style.xxx定义class</span></span><br><span class="line">              &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">'sass-loader'</span>, <span class="comment">// webpack在打包时是有顺序的，由下至上，由右至左</span></span><br><span class="line">          <span class="string">'postcss-loader'</span>, <span class="comment">// 为CSS添加-webkit等兼容开头</span></span><br><span class="line">          ]</span><br><span class="line">      &#125;,</span><br><span class="line">      ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">      <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">          filename: <span class="string">'[name].css'</span>,</span><br><span class="line">          chunkFilename: <span class="string">'[name].chunk.css'</span></span><br><span class="line">      &#125;),</span><br><span class="line">  ],</span><br><span class="line">  optimization: &#123;</span><br><span class="line">      minimizer: [</span><br><span class="line">      <span class="keyword">new</span> OptimizeCSSAssetsPlugin(&#123;&#125;)</span><br><span class="line">      ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>这样就完成了css的代码分割。</p>
<h2 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h2><p>我们可以在<code>package.json</code>中通过–来配置打包时的环境变量<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">    ...</span><br><span class="line">    "start": "webpack-dev-server --config webpack.common.js",</span><br><span class="line">    "build": "webpack --env.production --config webpack.common.js",</span><br><span class="line">    ...</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure></p>
<p>这样我们可以在<code>webpack.common.js</code>中获得这个变量并进行一定的代码逻辑，例如打包时我们就可以根据环境变量来判断是什么环境<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">env</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (env &amp;&amp; env.production) &#123;</span><br><span class="line">        <span class="keyword">return</span> merge(commonConfig, prodConfig)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> merge(commonConfig, devConfig)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>个人还是推荐使用<code>webpack.common.js</code>、<code>webpack.dev.js</code>和<code>webpack.prod.js</code>分别存放公用配置、开发环境打包配置和生产环境打包配置。</p>
<h2 id="typescript"><a href="#typescript" class="headerlink" title="typescript"></a>typescript</h2><p>typescript配置较为简单，首先需要安装typescript，并运行<code>tsc --init</code>创建<code>tsconfig.json</code>来配置ts，<br>然后安装<code>ts-loader</code>让webpack能配置ts文件。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            ...</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.tsx?$/</span>,</span><br><span class="line">                use: <span class="string">'ts-loader'</span>,</span><br><span class="line">                exclude: <span class="regexp">/node_nodules/</span></span><br><span class="line">            &#125;</span><br><span class="line">            ...</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure></p>
<h2 id="ESLint"><a href="#ESLint" class="headerlink" title="ESLint"></a>ESLint</h2><p>ESLint是一个插件化的javascript代码检测工具，使用ESLint可以让我们在协作开发时大家的代码更加规范化。<br>首先我们先要下载eslint<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add eslint --dev</span><br></pre></td></tr></table></figure></p>
<p>然后我们运行<code>npx eslint --init</code>,进行eslint的基础配置。<br>当配置完成后会有<code>.eslintrc.js</code>文件<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="string">"extends"</span>: <span class="string">'airbnb'</span>,</span><br><span class="line">  <span class="string">"parser"</span>: <span class="string">"babel-eslint"</span>,</span><br><span class="line">  <span class="string">"rules"</span>: &#123; <span class="comment">// 配置自己的规范</span></span><br><span class="line">    <span class="string">"react/jsx-filename-extension"</span>: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  globals: &#123; <span class="comment">// 设置可用全局变量</span></span><br><span class="line">    <span class="built_in">document</span>: <span class="literal">false</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>最后不要忘记在webpack中加上eslint<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            ...</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span>, <span class="comment">// 第三方库除外</span></span><br><span class="line">                use: [</span><br><span class="line">                    ...</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">"eslint-loader"</span>, <span class="comment">// 配置eslint在打包时检测</span></span><br><span class="line">                        options: &#123;</span><br><span class="line">                            fix: <span class="literal">true</span> <span class="comment">// 简单问题自动修复</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">            &#125;,</span><br><span class="line">            ...</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="webpack打包速度优化"><a href="#webpack打包速度优化" class="headerlink" title="webpack打包速度优化"></a>webpack打包速度优化</h2><ol>
<li>跟上技术的迭代(webpack/node/npm/yarn/…)<br>尽可能使用新版本的工具，因为新版本中做了更多的优化</li>
<li>在尽可能少的模块上应用 loader<br>通过配置 exclude / include 减少 loader 的使用</li>
<li>Plugin 尽可能精简并确保可靠<br>尽量使用官方推荐的插件，官方的优化的更好</li>
<li>resolve 参数合理配置<br>合理的配置可减少查找匹配的次数，降低性能损耗</li>
<li>控制包文件大小<br>不要引入一些未使用的模块包<br>配置 Tree-Shaking，打包时，不打包一些引入但未使用的模块<br>配置 splitChunks，对代码进行合理拆分，将大文件拆成小文件打包</li>
<li>thread-loader/parallel-webpack/happypack 多进程打包<br>webpack 默认是通过 nodeJs 来运行的，是单进程的打包<br>可以使用 thread-loader / parallel-webpack / happypack 这些技术，配置多进程打包</li>
<li>合理使用 sourceMap<br>打包生成的 sourceMap 越详细，打包的速度就越慢，可根据不同的环境配置不同的 sourceMap</li>
<li>结合 stats 分析打包结果<br>根据打包分析的结果，做对应的优化</li>
<li>开发环境内存编译<br>开发环境使用 webpack-dev-server，启动服务后，会将编译生成的文件放到内存中，而内存的读取速度远远高于硬盘的读取速度，可以让我们在开发环境中，webpack 性能得到很大的提升</li>
<li>开发环境无用插件剔除<br>例如：开发环境无需对代码进行压缩等</li>
</ol>
<h1 id="底层原理简单剖析"><a href="#底层原理简单剖析" class="headerlink" title="底层原理简单剖析"></a>底层原理简单剖析</h1><h2 id="自己编写一个Loader"><a href="#自己编写一个Loader" class="headerlink" title="自己编写一个Loader"></a>自己编写一个Loader</h2><p>实际上 loader 就是一个函数，这个函数可接收一个参数，这个参数指的就是引入文件的源代码，但是这个函数不能写成箭头函数，因为要用到 this，webpack 在调用 loader 时，会把这个 this 做一些变更，变更之后，才能用 this 里面的方法，如果写成箭头函数，this 指向就会有问题<br>假如我们有个<code>index.js</code>文件需要被打包<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'webpack-loader，akita'</span>)</span><br></pre></td></tr></table></figure></p>
<p>我们编写自己的loader<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">source</span>) </span>&#123; <span class="comment">// loader 不能用箭头函数 source为导入的文件源代码</span></span><br><span class="line">  <span class="keyword">return</span> source.replace(<span class="string">'akita'</span>, <span class="string">'akitaSummer'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>然后在webpack中配置<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js/</span>,</span><br><span class="line">        use: [&#123;</span><br><span class="line">          loader: path.resolve(__dirname, <span class="string">'./loaders/replaceLoader.js'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure></p>
<p>这样我们就完成了一个简单地loader。<br>不光可以使用<code>return</code>来返回处理后的文件源代码，我们也可以使用<code>this.callback</code>来处理返回后的源代码，通过<code>this.async()</code>我们也可以进行异步处理。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">source</span>) </span>&#123; <span class="comment">// loader 不能用箭头函数 source为导入的文件源代码</span></span><br><span class="line"><span class="comment">// return source.replace('akita', 'akitaSummer')</span></span><br><span class="line">  <span class="keyword">const</span> result = source.replace(<span class="string">'akitaSummer'</span>, <span class="string">'akitaSummer'</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.callback(<span class="literal">null</span>, result) <span class="comment">// 可以用callback进行处理</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// const callback = this.async()</span></span><br><span class="line">  <span class="comment">// setTimeout(() =&gt; &#123;</span></span><br><span class="line">  <span class="comment">//   callback(result) // 异步处理</span></span><br><span class="line">  <span class="comment">// &#125;, 1000)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// this.callback(</span></span><br><span class="line"><span class="comment">//   err: Error | null,</span></span><br><span class="line"><span class="comment">//   content: string | Buffer,</span></span><br><span class="line"><span class="comment">//   sourceMap?: SourceMap,</span></span><br><span class="line"><span class="comment">//   meta?: any</span></span><br><span class="line"><span class="comment">// )</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>通常情况下，webpack中可以传递option参数，如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js/</span>,</span><br><span class="line">        use: [&#123;</span><br><span class="line">          loader: path.resolve(__dirname, <span class="string">'./loaders/replaceLoader.js'</span>),</span><br><span class="line">          options: &#123;</span><br><span class="line">            name: <span class="string">'akita'</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure></p>
<p>我们在自己的loader中，就需要使用<code>this.query</code>来获得option。<br>webpack中推荐使用<code>loader-utils</code>来获得option。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> loaderUtils = <span class="built_in">require</span>(<span class="string">'loader-utils'</span>) <span class="comment">// 官方推荐的query获取方法</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">source</span>) </span>&#123; <span class="comment">// loader 不能用箭头函数 source为导入的文件源代码</span></span><br><span class="line">  <span class="comment">// console.log(this.query) // this.query 是loader中option传递的参数</span></span><br><span class="line">  <span class="keyword">const</span> options = loaderUtils.getOptions(<span class="keyword">this</span>) <span class="comment">// loader-utils会自动将this中query传递到options中</span></span><br><span class="line">  <span class="comment">// return source.replace('akita', options.name)</span></span><br><span class="line">  <span class="keyword">const</span> result = source.replace(<span class="string">'akitaSummer'</span>, options.name)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.callback(<span class="literal">null</span>, result) <span class="comment">// 可以用callback进行处理</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// const callback = this.async()</span></span><br><span class="line">  <span class="comment">// setTimeout(() =&gt; &#123;</span></span><br><span class="line">  <span class="comment">//   callback(result) // 异步处理</span></span><br><span class="line">  <span class="comment">// &#125;, 1000)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// this.callback(</span></span><br><span class="line"><span class="comment">//   err: Error | null,</span></span><br><span class="line"><span class="comment">//   content: string | Buffer,</span></span><br><span class="line"><span class="comment">//   sourceMap?: SourceMap,</span></span><br><span class="line"><span class="comment">//   meta?: any</span></span><br><span class="line"><span class="comment">// )</span></span><br></pre></td></tr></table></figure></p>
<p>最后，如果我们需要在配置中不用丑陋的<code>path.resolve(__dirname, &#39;./loaders/replaceLoader.js&#39;)</code>的话，我们可以配置<code>resolveLoader</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">resolveLoader:  &#123;</span><br><span class="line">    modules: [<span class="string">'node_modules'</span>, <span class="string">'./loaders'</span>] <span class="comment">// 未写路径时，loader查找的目录</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js/</span>,</span><br><span class="line">        use: [&#123;</span><br><span class="line">          <span class="comment">// loader: path.resolve(__dirname, './loaders/replaceLoader.js'),</span></span><br><span class="line">          loader: <span class="string">'replaceLoader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            name: <span class="string">'akita'</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="自己编写一个Plugin"><a href="#自己编写一个Plugin" class="headerlink" title="自己编写一个Plugin"></a>自己编写一个Plugin</h2><p>Plugin是一个类，所以我们的plugin用一个类来表示。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CoyprightWebpackPlugin</span> </span>&#123; <span class="comment">// 插件是一个类</span></span><br><span class="line">    <span class="keyword">constructor</span>(options) &#123; <span class="comment">// options是webpack中配置的参数的参数</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'plugin 被使用了'</span>, option.name)</span><br><span class="line">    &#125;</span><br><span class="line">    apply(compiler) &#123; <span class="comment">// webpack会调用apply方法 compiler是webpack实例</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = CoyprightWebpackPlugin</span><br></pre></td></tr></table></figure></p>
<p>webpack配置较为简单，我们只需引入即可<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> CopyRightWebpackPlugin = <span class="built_in">require</span>(<span class="string">'./plugins/coypright-webpack-plugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  .....</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> CopyRightWebpackPlugin(&#123;<span class="attr">name</span>: <span class="string">'akitaSummer'</span>&#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>apply</code>中<code>compiler</code>提供了打包时刻，你可以在不同的打包时刻进行一定的操作<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CoyprightWebpackPlugin</span> </span>&#123; <span class="comment">// 插件是一个类</span></span><br><span class="line">    <span class="keyword">constructor</span>(options) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'plugin 被使用了'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    apply(compiler) &#123; <span class="comment">// webpack会调用apply方法 compiler是webpack实例</span></span><br><span class="line">        compiler.hooks.emit.tapAsync(<span class="string">'CoyprightWebpackPlugin'</span>, (compilation, callback) =&gt; &#123; <span class="comment">//emit 是在文件被放置于dist目录时调用</span></span><br><span class="line">            <span class="comment">// compilation 存放此次打包内容， compiler存放所有打包内容</span></span><br><span class="line">            <span class="built_in">console</span>.log(compilation.assets) <span class="comment">// assets中存放了打包结果</span></span><br><span class="line">            compilation.assets[<span class="string">'copyright.txt'</span>] = &#123;</span><br><span class="line">                source: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 内容</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="string">'copyright'</span></span><br><span class="line">                &#125;,</span><br><span class="line">                size: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 大小</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="number">9</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            callback() <span class="comment">// 必须调用</span></span><br><span class="line">        &#125;)</span><br><span class="line">        compiler.hooks.compile.tap(<span class="string">'CoyprightWebpackPlugin'</span>, (compilation) =&gt; &#123;</span><br><span class="line">            <span class="comment">// compile 是同步函数</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'compile'</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = CoyprightWebpackPlugin</span><br></pre></td></tr></table></figure></p>
<p>其它的打包时刻</p>
<ul>
<li>done (异步时刻)表示打包完成</li>
<li>compile (同步时刻)</li>
<li>同步时刻是 tap 且没有 callback</li>
<li>异步时刻是 tapAsync 有 callback</li>
</ul>
<h2 id="自己编写一个Bundler"><a href="#自己编写一个Bundler" class="headerlink" title="自己编写一个Bundler"></a>自己编写一个Bundler</h2><p>首先我们先理一下思路，如果需要编写一个打包文件，需要能解析文件，能遍历出所有的文件，能将所有的解析文件进行合并。<br>那我们就一步步完成这三个功能。<br>首先我们先创建需要打包的文件。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /src/word.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> word = <span class="string">'hello'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// /src/message.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; word &#125; <span class="keyword">from</span> <span class="string">'./word.js'</span></span><br><span class="line"><span class="comment">// 需要写 .js 后缀，因为没有使用 webpack</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> message = <span class="string">`say <span class="subst">$&#123;word&#125;</span>`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> message</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// /src/index.js</span></span><br><span class="line"><span class="keyword">import</span> message <span class="keyword">from</span> <span class="string">'./message.js'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(message)</span><br></pre></td></tr></table></figure></p>
<p>接下来我们新建一个<code>bundler.js</code>作为我们的打包工具。<br>在解析文件时，我们需要<code>@babel/parser</code>和<code>@babel/traverse</code>来将文件源码转化成抽象语法树，并解析，最后在使用<code>@babel/core</code>将抽象语法树转化为代码<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> parser = <span class="built_in">require</span>(<span class="string">'@babel/parser'</span>) <span class="comment">// 将文件源码转化为抽象语法树</span></span><br><span class="line"><span class="keyword">const</span> traverse = <span class="built_in">require</span>(<span class="string">'@babel/traverse'</span>).default <span class="comment">// 默认是es6导出</span></span><br><span class="line"><span class="keyword">const</span> babel = <span class="built_in">require</span>(<span class="string">'@babel/core'</span>) <span class="comment">// 转换代码</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> moduleAnalyser = <span class="function">(<span class="params">filename</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> content = fs.readFileSync(filename, <span class="string">'utf-8'</span>) <span class="comment">// 读取文件</span></span><br><span class="line">    <span class="keyword">const</span> ast = parser.parse(content, &#123; <span class="comment">// 将文件源码转化为抽象语法树</span></span><br><span class="line">        sourceType: <span class="string">'module'</span> <span class="comment">// es6引用时配置</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> dependencies = &#123;&#125;</span><br><span class="line">    traverse(ast, &#123; <span class="comment">// 接收抽象语法树并解析</span></span><br><span class="line">        ImportDeclaration(&#123; node &#125;) &#123; <span class="comment">// 当节点为ImportDeclaration时</span></span><br><span class="line">            <span class="keyword">const</span> dirname = path.dirname(filename)</span><br><span class="line">            <span class="keyword">const</span> newFile = <span class="string">'./'</span> + path.join(dirname, node.source.value) <span class="comment">// 处理文件路径</span></span><br><span class="line">            dependencies[node.source.value] = newFile <span class="comment">// 将import结点储存于对象中</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> &#123; code &#125; = babel.transformFromAst(ast, <span class="literal">null</span>, &#123; <span class="comment">// transformFromAst方法可将抽象语法树转化为代码</span></span><br><span class="line">        presets: [<span class="string">'@babel/preset-env'</span>] <span class="comment">// es6 转 es5</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        filename,</span><br><span class="line">        dependencies,</span><br><span class="line">        code</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// console.log(ast.program.body)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这样我们的第一步就完成了，接下来我们需要将所有的文件全部解析。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> makeDependenciesGraph = <span class="function">(<span class="params">entry</span>) =&gt;</span> &#123; <span class="comment">// 依赖图谱</span></span><br><span class="line">    <span class="keyword">const</span> entryModule = moduleAnalyser(entry) <span class="comment">// 得到入口文件的详情</span></span><br><span class="line">    <span class="keyword">const</span> graphArray = [entryModule]</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; graphArray.length; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> item = graphArray[i]</span><br><span class="line">        <span class="keyword">const</span> &#123; dependencies &#125; = item <span class="comment">// 得到文件的依赖</span></span><br><span class="line">        <span class="keyword">if</span> (dependencies) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> j <span class="keyword">in</span> dependencies) &#123;</span><br><span class="line">                graphArray.push(moduleAnalyser(dependencies[j])) <span class="comment">// 将依赖分析后添加进graphArray里</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> graph = &#123;&#125;</span><br><span class="line">    graphArray.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123; <span class="comment">// 转换数据结构</span></span><br><span class="line">        graph[item.filename] = &#123;</span><br><span class="line">            dependencies: item.dependencies,</span><br><span class="line">            code: item.code</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> graph</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>最后我们将所有解析完毕的文件进行打包整合<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> generateCode = <span class="function">(<span class="params">entry</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> graph = <span class="built_in">JSON</span>.stringify(makeDependenciesGraph(entry)) <span class="comment">// 放置模板字符串会将对象转化为[Object Object]</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">    ;(function(graph) &#123; // 使用闭包，防止污染全局</span></span><br><span class="line"><span class="string">        function require(module) &#123; // 自己构造require函数</span></span><br><span class="line"><span class="string">            function localRequire(relativePath) &#123; // 将相对路径转换成真实路径后调用</span></span><br><span class="line"><span class="string">                return require(graph[module].dependencies[relativePath])</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            var exports = &#123;&#125; // 内部需要exports对象</span></span><br><span class="line"><span class="string">            ;(function (require, exports, code) &#123;// 使用闭包，防止污染全局</span></span><br><span class="line"><span class="string">                eval(code) // graph[module].code 中有require函数，会递归调用，不断引入</span></span><br><span class="line"><span class="string">            &#125;)(localRequire, exports, graph[module].code)</span></span><br><span class="line"><span class="string">            return exports</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        require('<span class="subst">$&#123;entry&#125;</span>')</span></span><br><span class="line"><span class="string">    &#125;)(</span></span><br><span class="line"><span class="string">        <span class="subst">$&#123;graph&#125;</span></span></span><br><span class="line"><span class="string">    )</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>全部代码<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> parser = <span class="built_in">require</span>(<span class="string">'@babel/parser'</span>) <span class="comment">// 将文件源码转化为抽象语法树</span></span><br><span class="line"><span class="keyword">const</span> traverse = <span class="built_in">require</span>(<span class="string">'@babel/traverse'</span>).default <span class="comment">// 默认是es6导出</span></span><br><span class="line"><span class="keyword">const</span> babel = <span class="built_in">require</span>(<span class="string">'@babel/core'</span>) <span class="comment">// 转换代码</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> moduleAnalyser = <span class="function">(<span class="params">filename</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> content = fs.readFileSync(filename, <span class="string">'utf-8'</span>)</span><br><span class="line">    <span class="keyword">const</span> ast = parser.parse(content, &#123;</span><br><span class="line">        sourceType: <span class="string">'module'</span> <span class="comment">// es6引用时配置</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> dependencies = &#123;&#125;</span><br><span class="line">    traverse(ast, &#123; <span class="comment">// 接收抽象语法树并解析</span></span><br><span class="line">        ImportDeclaration(&#123; node &#125;) &#123; <span class="comment">// 当节点为ImportDeclaration时</span></span><br><span class="line">            <span class="keyword">const</span> dirname = path.dirname(filename)</span><br><span class="line">            <span class="keyword">const</span> newFile = <span class="string">'./'</span> + path.join(dirname, node.source.value) <span class="comment">// 处理文件路径</span></span><br><span class="line">            dependencies[node.source.value] = newFile <span class="comment">// 将import结点储存于对象中</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> &#123; code &#125; = babel.transformFromAst(ast, <span class="literal">null</span>, &#123; <span class="comment">// transformFromAst方法可将抽象语法树转化为代码</span></span><br><span class="line">        presets: [<span class="string">'@babel/preset-env'</span>] <span class="comment">// es6 转 es5</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        filename,</span><br><span class="line">        dependencies,</span><br><span class="line">        code</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// console.log(ast.program.body)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> makeDependenciesGraph = <span class="function">(<span class="params">entry</span>) =&gt;</span> &#123; <span class="comment">// 依赖图谱</span></span><br><span class="line">    <span class="keyword">const</span> entryModule = moduleAnalyser(entry) <span class="comment">// 得到入口文件的详情</span></span><br><span class="line">    <span class="keyword">const</span> graphArray = [entryModule]</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; graphArray.length; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> item = graphArray[i]</span><br><span class="line">        <span class="keyword">const</span> &#123; dependencies &#125; = item <span class="comment">// 得到文件的依赖</span></span><br><span class="line">        <span class="keyword">if</span> (dependencies) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> j <span class="keyword">in</span> dependencies) &#123;</span><br><span class="line">                graphArray.push(moduleAnalyser(dependencies[j])) <span class="comment">// 将依赖分析后添加进graphArray里</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> graph = &#123;&#125;</span><br><span class="line">    graphArray.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123; <span class="comment">// 转换数据结构</span></span><br><span class="line">        graph[item.filename] = &#123;</span><br><span class="line">            dependencies: item.dependencies,</span><br><span class="line">            code: item.code</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> graph</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> generateCode = <span class="function">(<span class="params">entry</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> graph = <span class="built_in">JSON</span>.stringify(makeDependenciesGraph(entry)) <span class="comment">// 放置模板字符串会将对象转化为[Object Object]</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">    ;(function(graph) &#123; // 使用闭包，防止污染全局</span></span><br><span class="line"><span class="string">        function require(module) &#123; // 自己构造require函数</span></span><br><span class="line"><span class="string">            function localRequire(relativePath) &#123; // 将相对路径转换成真实路径后调用</span></span><br><span class="line"><span class="string">                return require(graph[module].dependencies[relativePath])</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            var exports = &#123;&#125; // 内部需要exports对象</span></span><br><span class="line"><span class="string">            ;(function (require, exports, code) &#123;// 使用闭包，防止污染全局</span></span><br><span class="line"><span class="string">                eval(code) // graph[module].code 中有require函数，会递归调用，不断引入</span></span><br><span class="line"><span class="string">            &#125;)(localRequire, exports, graph[module].code)</span></span><br><span class="line"><span class="string">            return exports</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        require('<span class="subst">$&#123;entry&#125;</span>')</span></span><br><span class="line"><span class="string">    &#125;)(</span></span><br><span class="line"><span class="string">        <span class="subst">$&#123;graph&#125;</span></span></span><br><span class="line"><span class="string">    )</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> code = generateCode(<span class="string">'./src/index.js'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(code)</span><br></pre></td></tr></table></figure></p>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Webpack/" rel="tag"># Webpack</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/11/05/webpack4配置vue开发环境/" rel="next" title="webpack4配置vue开发环境">
                <i class="fa fa-chevron-left"></i> webpack4配置vue开发环境
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/12/04/ReactNative原生模块开发与调用/" rel="prev" title="React Native原生模块开发与调用">
                React Native原生模块开发与调用 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      
        <div id="gitment-container"></div>
      
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/v2-e386393694cb08152bb316fa79bba113_hd.jpg" alt="Akita Summer">
            
              <p class="site-author-name" itemprop="name">Akita Summer</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">9</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                    <span class="site-state-item-count">1</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">13</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/akitaSummer" title="GitHub &rarr; https://github.com/akitaSummer" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:644171127@qq.com" title="E-Mail &rarr; mailto:644171127@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#webpack核心概念"><span class="nav-number">1.</span> <span class="nav-text">webpack核心概念</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Entry"><span class="nav-number">1.1.</span> <span class="nav-text">Entry</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Output"><span class="nav-number">1.2.</span> <span class="nav-text">Output</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Loader"><span class="nav-number">1.3.</span> <span class="nav-text">Loader</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Plugins"><span class="nav-number">1.4.</span> <span class="nav-text">Plugins</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#webpack基本配置"><span class="nav-number">2.</span> <span class="nav-text">webpack基本配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#准备"><span class="nav-number">2.1.</span> <span class="nav-text">准备</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#entry"><span class="nav-number">2.2.</span> <span class="nav-text">entry</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#output"><span class="nav-number">2.3.</span> <span class="nav-text">output</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#module"><span class="nav-number">2.4.</span> <span class="nav-text">module</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#plugins"><span class="nav-number">2.5.</span> <span class="nav-text">plugins</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#externals"><span class="nav-number">2.6.</span> <span class="nav-text">externals</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#resolve"><span class="nav-number">2.7.</span> <span class="nav-text">resolve</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#常见需求配置"><span class="nav-number">3.</span> <span class="nav-text">常见需求配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#本地启动开发服务器进行开发"><span class="nav-number">3.1.</span> <span class="nav-text">本地启动开发服务器进行开发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#解析ES6语法"><span class="nav-number">3.2.</span> <span class="nav-text">解析ES6语法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Tree-Shaking"><span class="nav-number">3.3.</span> <span class="nav-text">Tree Shaking</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#代码分割-Code-Splitting"><span class="nav-number">3.4.</span> <span class="nav-text">代码分割(Code Splitting)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#css的代码分割"><span class="nav-number">3.5.</span> <span class="nav-text">css的代码分割</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#环境变量"><span class="nav-number">3.6.</span> <span class="nav-text">环境变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#typescript"><span class="nav-number">3.7.</span> <span class="nav-text">typescript</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ESLint"><span class="nav-number">3.8.</span> <span class="nav-text">ESLint</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#webpack打包速度优化"><span class="nav-number">3.9.</span> <span class="nav-text">webpack打包速度优化</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#底层原理简单剖析"><span class="nav-number">4.</span> <span class="nav-text">底层原理简单剖析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#自己编写一个Loader"><span class="nav-number">4.1.</span> <span class="nav-text">自己编写一个Loader</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自己编写一个Plugin"><span class="nav-number">4.2.</span> <span class="nav-text">自己编写一个Plugin</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自己编写一个Bundler"><span class="nav-number">4.3.</span> <span class="nav-text">自己编写一个Bundler</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2023</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Akita Summer</span>

  

  
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.0.0</div>
-->



        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.0"></script>

  <script src="/js/src/motion.js?v=7.0.0"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.0"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.0"></script>



  
  <script src="/js/src/scrollspy.js?v=7.0.0"></script>
<script src="/js/src/post-details.js?v=7.0.0"></script>



  


  <script src="/js/src/bootstrap.js?v=7.0.0"></script>



  


  
    <!-- LOCAL: You can save these files to your site and update links -->

  
  <script src="https://cdn.jsdelivr.net/gh/theme-next/theme-next-gitment@1/gitmint.browser.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/theme-next/theme-next-gitment@1/default.css">
<!-- END LOCAL -->

<style>
#gitment-container a {
  border-bottom: none;
}

</style>

<script>
  function renderGitment() {
    var gitment = new Gitmint({
      id: window.location.pathname,
      owner: 'akitaSummer',
      repo: 'blogComment',
      
        lang: '' || navigator.language || navigator.systemLanguage || navigator.userLanguage,
      
      oauth: {
      
      
        client_secret: '624f365dba9bccb32867a185a2cf65556335f06e',
      
        client_id: 'f433f680d31e0d644e2c'
      }
    });
    gitment.render('gitment-container');
  }

  
    renderGitment();
  
</script>

  


  





  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
